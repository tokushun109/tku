{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended",
    ":semanticCommits"
  ],
  "timezone": "Asia/Tokyo",
  "schedule": [
    "after 10pm and before 11pm on Sunday"
  ],
  "prHourlyLimit": 4,
  "prConcurrentLimit": 10,
  "stabilityDays": 3,
  "enabledManagers": [
    "npm",
    "gomod",
    "dockerfile",
    "terraform",
    "github-actions"
  ],
  "packageRules": [
    {
      "description": "majorは手動レビュー",
      "matchUpdateTypes": [
        "major"
      ],
      "labels": [
        "deps:major"
      ],
      "automerge": false,
      "prPriority": -1
    },
    {
      "description": "minor/patchは自動マージ（テスト成功が条件）",
      "matchUpdateTypes": [
        "minor",
        "patch"
      ],
      "automerge": true
    },
    {
      "description": "GitHub Actions は1PRに集約",
      "matchManagers": [
        "github-actions"
      ],
      "groupName": "GitHub Actions"
    },
    {
      "description": "Dockerfile ベースイメージ更新",
      "matchManagers": [
        "dockerfile"
      ],
      "groupName": "Docker base images"
    },
    {
      "description": "frontend: コア依存関係",
      "matchManagers": [
        "npm"
      ],
      "matchPaths": [
        "frontend/**"
      ],
      "groupName": "frontend: core deps",
      "matchPackagePatterns": [
        "^react",
        "^next",
        "^@next/",
        "^typescript"
      ]
    },
    {
      "description": "frontend: その他の依存関係",
      "matchManagers": [
        "npm"
      ],
      "matchPaths": [
        "frontend/**"
      ],
      "groupName": "frontend: other deps"
    },
    {
      "description": "backend: コア依存関係",
      "matchManagers": [
        "gomod"
      ],
      "matchPaths": [
        "backend/**"
      ],
      "groupName": "backend: core deps",
      "matchPackageNames": [
        "github.com/gorilla/mux",
        "gorm.io/gorm",
        "gorm.io/driver/mysql"
      ],
      "postUpdateOptions": [
        "gomodTidy"
      ]
    },
    {
      "description": "backend: その他の依存関係",
      "matchManagers": [
        "gomod"
      ],
      "matchPaths": [
        "backend/**"
      ],
      "groupName": "backend: other deps",
      "postUpdateOptions": [
        "gomodTidy"
      ]
    },
    {
      "description": "infra: CDK for Terraform コア",
      "matchManagers": [
        "npm"
      ],
      "matchPaths": [
        "infra/**"
      ],
      "groupName": "infra: CDKTF core",
      "matchPackagePatterns": [
        "^cdktf",
        "^@cdktf/",
        "^constructs"
      ]
    },
    {
      "description": "infra: 開発ツール・型定義",
      "matchManagers": [
        "npm"
      ],
      "matchPaths": [
        "infra/**"
      ],
      "groupName": "infra: dev tools + types",
      "matchPackagePatterns": [
        "^@types/",
        "^typescript",
        "^jest",
        "^ts-jest",
        "^ts-node"
      ]
    },
    {
      "description": "Terraform プロバイダ/モジュール",
      "matchManagers": [
        "terraform"
      ],
      "groupName": "Terraform deps"
    }
  ]
}
